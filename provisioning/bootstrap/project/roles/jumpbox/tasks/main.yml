---
- command: subscription-manager repos --enable={{ item }}
  loop:
  - rhel-7-server-rpms
  - rhel-7-server-extras-rpms  
  - rhel-7-server-ose-3.11-rpms
  - rhel-7-server-ansible-2.6-rpms 
  - rhel-7-fast-datapath-rpms
- pip: 
    name: "{{ item }}"
  loop:
  - ansible==2.6.12
- yum:
    name: "{{ item }}"
    state: present
  with_items:
  - docker
  - dnsmasq
  - bind-utils
  - openshift-ansible 
  - atomic
- systemd:
    name: "{{ item }}"
    enabled: yes
    state: restarted
  loop:
  - docker
  - dnsmasq
- docker_image:
    name: "{{ item }}"
    state: present
  with_items:
  - avinetworks/avitools:18.2.1
- lineinfile:
    dest: /etc/bashrc
    insertafter: EOF
    line: alias dig="docker run --net=host -it avinetworks/avitools:18.2.1 dig"

- docker_container:
    name: avitools
    hostname: avitools
    image: avinetworks/avitools:18.2.1
    command: bash
    volumes: /opt:/opt
    tty: yes
    interactive: yes
    restart: yes
    detach: true
    state: started
- lineinfile:
    dest: /opt/bootstrap/openshift-ansible/dnsmasq-snippet.conf
    insertafter: EOF
    line: server=/lab/{{hostvars['jumpbox.lab']['privateIp']}} 

- template:
    src: ocp_inventory.j2
    dest: /opt/bootstrap/openshift-ansible/ocp_inventory_{{hostvars[item]['student_domain']}}
    owner: root
    group: wheel
    mode: 0644
  when: 
  - hostvars[item]['Lab_Group'] == "controllers"
  with_inventory_hostnames: all
